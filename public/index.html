<!DOCTYPE html>
<html>
  <head>
    <title>Twitter Trends Results</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>Twitter Trends Scraper</h1>

      <div class="login-form">
        <div class="form-group">
          <label for="username">Twitter Username:</label>
          <input
            type="text"
            id="username"
            placeholder="For Demo username Type - achyut69069"
            required
          />
        </div>
        <div class="form-group">
          <label for="password">Twitter Password:</label>
          <input
            type="password"
            id="password"
            placeholder="For Demo password Type - Achyut@123"
            required
          />
        </div>
      </div>

      <button onclick="fetchTrends()" id="fetchButton">
        Click here to run the script
      </button>

      <div id="loading" class="loading">
        Fetching trending topics... Please wait...
      </div>

      <div id="error" class="error"></div>

      <div id="results">
        <h2>
          These are the most happening topics as on <span id="timestamp"></span>
        </h2>

        <ul class="trend-list" id="trendsList"></ul>

        <p>
          The IP address used for this query was <span id="ipAddress"></span>
        </p>

        <h3>JSON extract from MongoDB:</h3>
        <div class="json-data" id="jsonData"></div>

        <button onclick="fetchTrends()" style="margin-top: 20px">
          Click here to run the query again
        </button>
      </div>
    </div>

    <script>
      function fetchTrends() {
        const button = document.getElementById("fetchButton");
        const loading = document.getElementById("loading");
        const results = document.getElementById("results");
        const error = document.getElementById("error");
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (!username || !password) {
          error.style.display = "block";
          error.textContent = "Please enter both username and password";
          return;
        }

        // Reset display
        button.disabled = true;
        loading.style.display = "block";
        results.style.display = "none";
        error.style.display = "none";

        fetch("/api/scrape", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ username, password }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Failed to fetch trends");
            }
            return response.json();
          })
          .then((data) => {
            // Update timestamp
            document.getElementById("timestamp").textContent = new Date(
              data.timestamp
            ).toLocaleString();

            // Update IP address
            document.getElementById("ipAddress").textContent = data.ip_address;

            // Update trends list
            const trendsList = document.getElementById("trendsList");
            trendsList.innerHTML = "";
            for (let i = 1; i <= 4; i++) {
              const li = document.createElement("li");
              li.className = "trend-item";
              li.textContent = `- ${data["nameoftrend" + i]}`;
              trendsList.appendChild(li);
            }

            // Update JSON data
            document.getElementById("jsonData").textContent = JSON.stringify(
              data,
              null,
              2
            );

            // Show results
            loading.style.display = "none";
            results.style.display = "block";
          })
          .catch((err) => {
            loading.style.display = "none";
            error.style.display = "block";
            error.textContent = `Error: ${err.message}`;
          })
          .finally(() => {
            button.disabled = false;
          });
      }
    </script>
  </body>
</html>
